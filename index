<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EN-Risk ìì—°ì¬í•´ í‰ê°€ ë³´ê³ ì„œ</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />

<style>
    :root {
        --primary: #1a6fb4;
        --secondary: #f4f6f8;
        --border: #e1e4e8;
        --text-main: #222;
        --text-sub: #555;
        
        /* Risk Colors */
        --c-verylow: #e3f2fd; --t-verylow: #1565c0;
        --c-low: #bbdefb;     --t-low: #0d47a1;
        --c-medium: #fff9c4;  --t-medium: #fbc02d;
        --c-high: #ffccbc;    --t-high: #d84315;
        --c-extreme: #ffcdd2; --t-extreme: #b71c1c;
    }

    body { font-family: 'Pretendard', sans-serif; margin: 0; padding: 40px; background: #f9f9f9; color: var(--text-main); line-height: 1.6; }
    
    .container { max-width: 950px; margin: 0 auto; background: #fff; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border-radius: 12px; }

    h1 { font-size: 28px; margin: 0 0 10px 0; font-weight: 800; color: #111; letter-spacing: -0.5px; }
    .subtitle { font-size: 14px; color: #888; margin-bottom: 40px; border-bottom: 2px solid var(--primary); padding-bottom: 15px; display: flex; justify-content: space-between; }

    /* Section Styles */
    .section-title { font-size: 20px; font-weight: 700; margin-top: 60px; margin-bottom: 20px; display: flex; align-items: center; color: #333; }
    .section-title::before { content: ''; display: block; width: 6px; height: 24px; background: var(--primary); margin-right: 12px; border-radius: 2px; }

    /* Input Section */
    .input-group { background: var(--secondary); padding: 30px; border-radius: 8px; border: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .input-item { display: flex; flex-direction: column; }
    .input-item label { font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--text-sub); }
    .input-item input { padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 15px; font-family: inherit; transition: border 0.2s; }
    .input-item input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(26, 111, 180, 0.1); }
    .full-width { grid-column: span 2; }

    /* Buttons */
    .btn-area { margin-top: 25px; text-align: center; }
    button { padding: 14px 35px; font-size: 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; transition: all 0.2s; font-family: inherit; }
    .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 6px rgba(26, 111, 180, 0.2); }
    .btn-primary:hover { background: #155a93; transform: translateY(-2px); }
    .btn-secondary { background: #e0e0e0; color: #333; margin-right: 10px; }
    .btn-secondary:hover { background: #d0d0d0; }

    /* Report Tables */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; table-layout: fixed; }
    th, td { border-bottom: 1px solid var(--border); padding: 16px 12px; text-align: left; }
    th { background: #f8f9fa; font-weight: 700; color: #444; border-top: 2px solid #333; }
    
    /* Risk Badges */
    .badge { padding: 4px 10px; border-radius: 4px; font-weight: 700; font-size: 12px; display: inline-block; text-align: center; letter-spacing: 0.5px; }
    .badge.VERY-LOW { background: var(--c-verylow); color: var(--t-verylow); }
    .badge.LOW { background: var(--c-low); color: var(--t-low); }
    .badge.MEDIUM { background: var(--c-medium); color: var(--t-medium); }
    .badge.HIGH { background: var(--c-high); color: var(--t-high); }
    .badge.EXTREME { background: var(--c-extreme); color: var(--t-extreme); }

    /* Risk Bar Visual */
    .risk-bar-wrapper { display: flex; height: 12px; border-radius: 6px; overflow: hidden; background: #eee; width: 100%; margin-top: 5px; }
    .risk-segment { flex: 1; border-right: 2px solid #fff; opacity: 0.2; transition: opacity 0.3s; }
    .risk-segment:last-child { border-right: none; }
    
    /* Active Segments */
    .risk-bar-wrapper[data-level="VERY LOW"] .s1 { background: #2196f3; opacity: 1; }
    .risk-bar-wrapper[data-level="LOW"] .s1, 
    .risk-bar-wrapper[data-level="LOW"] .s2 { background: #4caf50; opacity: 1; }
    .risk-bar-wrapper[data-level="MEDIUM"] .s1,
    .risk-bar-wrapper[data-level="MEDIUM"] .s2,
    .risk-bar-wrapper[data-level="MEDIUM"] .s3 { background: #ffeb3b; opacity: 1; }
    .risk-bar-wrapper[data-level="HIGH"] .s1,
    .risk-bar-wrapper[data-level="HIGH"] .s2,
    .risk-bar-wrapper[data-level="HIGH"] .s3,
    .risk-bar-wrapper[data-level="HIGH"] .s4 { background: #ff9800; opacity: 1; }
    .risk-bar-wrapper[data-level="EXTREME"] .s1,
    .risk-bar-wrapper[data-level="EXTREME"] .s2,
    .risk-bar-wrapper[data-level="EXTREME"] .s3,
    .risk-bar-wrapper[data-level="EXTREME"] .s4,
    .risk-bar-wrapper[data-level="EXTREME"] .s5 { background: #f44336; opacity: 1; }

    /* Analysis Box */
    .analysis-box { background: #fafafa; border-left: 4px solid #ccc; padding: 25px; margin-bottom: 25px; border-radius: 0 8px 8px 0; }
    .analysis-box h3 { margin: 0 0 12px 0; font-size: 16px; color: #222; font-weight: 700; display: flex; align-items: center; }
    .analysis-box p { margin: 0; font-size: 15px; color: #444; text-align: justify; }

    /* Engineering Opinion Box */
    .eng-opinion-box { background: #fff; border: 1px solid #ddd; padding: 30px; border-left: 5px solid #333; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
    .eng-opinion-text { font-size: 15px; color: #333; line-height: 1.8; text-align: justify; }

    /* Summary Box */
    .exec-summary { background: #eff3f6; border: 1px solid #dbe3e9; padding: 25px; border-radius: 8px; margin-bottom: 50px; }
    .exec-summary h3 { margin-top: 0; color: #2c3e50; font-size: 18px; }

    /* Professional Terms Highlight */
    .tech-term { font-weight: 700; color: #333; background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; margin: 0 2px; }
    .diff-high { color: #d32f2f; font-weight: 700; }
    .diff-low { color: #1976d2; font-weight: 700; }

    /* Print Optimization */
    @media print {
        body { padding: 0; background: #fff; }
        .container { box-shadow: none; max-width: 100%; padding: 0; }
        .no-print, .input-group, .btn-area { display: none !important; }
        .section-title { margin-top: 30px; }
        table { page-break-inside: avoid; }
        .analysis-box, .eng-opinion-box { page-break-inside: avoid; border: 1px solid #ddd; }
    }
</style>
</head>
<body>

<div class="container">
    <h1>EN-Risk Natural Hazard Assessment Report</h1>
    <div class="subtitle">
        <span>Prepared by <b>O&M Risk Analysis Team</b></span>
        <span id="report-date"></span>
    </div>

    <div class="no-print">
        <h2 class="section-title">â… . ì…ë ¥ê°’ ì„¤ì • (Input Parameters)</h2>
        <div class="input-group">
            <div class="input-item full-width">
                <label>ë°œì „ì†Œ ëª…ì¹­</label>
                <input id="site_name" placeholder="ì˜ˆ: ì˜ì•” F1 íƒœì–‘ê´‘ë°œì „ì†Œ">
            </div>
            <div class="input-item">
                <label>ìµœëŒ€ í’ì† (m/s)</label>
                <input type="number" id="wind_value" placeholder="ì˜ˆ: 21.5">
            </div>
            <div class="input-item">
                <label>ìµœì‹¬ì‹ ì ì„¤ (cm)</label>
                <input type="number" id="snow_value" placeholder="ì˜ˆ: 19.3">
            </div>
            <div class="input-item">
                <label>ì¼ì¼ ìµœëŒ€ ê°•ìš°ëŸ‰ (mm/day)</label>
                <input type="number" id="rainD_value" placeholder="ì˜ˆ: 128.8">
            </div>
            <div class="input-item">
                <label>1ì‹œê°„ ìµœëŒ€ ê°•ìš°ëŸ‰ (mm/h)</label>
                <input type="number" id="rain1_value" placeholder="ì˜ˆ: 63.3">
            </div>
        </div>

        <div class="btn-area">
            <button class="btn-secondary" onclick="fillExampleData()">ğŸ² ëœë¤ ìƒ˜í”Œ ë°ì´í„°</button>
            <button class="btn-primary" onclick="renderReport()">ğŸ“Š ë³´ê³ ì„œ ìƒì„±í•˜ê¸°</button>
        </div>
        <hr style="margin: 50px 0; border: none; border-top: 1px dashed #ddd;">
    </div>

    <div id="generated_report" style="display:none;">
        
        <div id="executive_summary" class="exec-summary"></div>

        <h2 class="section-title">â…¡. ìì—°ì¬í•´ ë¦¬ìŠ¤í¬ ì •ëŸ‰ í‰ê°€</h2>
        <table id="risk-table">
            <thead>
                <tr>
                    <th width="15%">êµ¬ë¶„ (Hazard)</th>
                    <th width="15%">ì…ë ¥ê°’</th>
                    <th width="20%">ìœ„í—˜ë„ (Level)</th>
                    <th width="20%">ë¦¬ìŠ¤í¬ ì§€í‘œ (Visual)</th>
                    <th width="30%">ìš”ì•½ í‰ê°€</th>
                </tr>
            </thead>
            <tbody id="risk-table-body"></tbody>
        </table>

        <h2 class="section-title">â…¢. ìœ„í—˜ìš”ì†Œë³„ ìƒì„¸ ë¶„ì„ ë° ì œì•ˆ</h2>
        <div id="detail-analysis"></div>

        <h2 class="section-title">â…£. ì¢…í•© ì—”ì§€ë‹ˆì–´ë§ ì†Œê²¬ (Engineering Opinion)</h2>
        <div class="eng-opinion-box">
            <div id="extended-analysis" class="eng-opinion-text"></div>
        </div>

        <div style="margin-top:50px; text-align:center; font-size:12px; color:#999; line-height:1.5;">
            * ë³¸ ë³´ê³ ì„œì˜ ë¹„êµ ì§€í‘œëŠ” ê¸°ìƒì²­ 30ë…„ í‰ë…„ê°’(1991~2020) í†µê³„ë¥¼ Baselineìœ¼ë¡œ ì‚°ì •í•˜ì˜€ìŠµë‹ˆë‹¤.<br>
            * ì œì‹œëœ ì†Œê²¬ì€ ì˜ˆë¹„ íƒ€ë‹¹ì„± ê²€í† (Feasibility Study) ë‹¨ê³„ì˜ ì°¸ê³  ìë£Œì´ë©°, ì‹¤ì‹œ ì„¤ê³„ ì‹œì—ëŠ” ì „ë¬¸ ì—…ì²´ì˜ ì§€ë°˜ ì¡°ì‚¬ ë° êµ¬ì¡° ê²€í† ì„œê°€ ìš°ì„ í•©ë‹ˆë‹¤.
        </div>
    </div>
</div>

<script>
/* ==================== CONFIGURATION ==================== */
const KMA_BASE = {
    WIND: 11.6,       // m/s
    RAIN_DAILY: 133.3,// mm
    RAIN_1H: 44.6,    // mm
    SNOW: 20.2        // cm
};

document.getElementById('report-date').innerText = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });

/* ==================== LOGIC FUNCTIONS ==================== */

function determineLevel(type, value) {
    const v = parseFloat(value);
    const thresholds = {
        "Wind":      [8, 14, 20, 28],
        "RainDaily": [30, 80, 150, 250],
        "Rain1h":    [10, 25, 60, 90],
        "Snow":      [8, 20, 40, 60]
    };

    const t = thresholds[type];
    if(v > t[3]) return "EXTREME";
    if(v > t[2]) return "HIGH";
    if(v > t[1]) return "MEDIUM";
    if(v > t[0]) return "LOW";
    return "VERY LOW";
}

/* ì „ë¬¸ì ì¸ ë¹„êµ í…ìŠ¤íŠ¸ ìƒì„±ê¸° (ë‹¨ìˆœ % ëŒ€ì‹  ìš©ì–´ ì‚¬ìš©) */
function getProfessionalDiffHTML(val, base, unit) {
    const diff = val - base;
    const ratio = (val / base).toFixed(2); // ë°°ìˆ˜ (ì˜ˆ: 1.5ë°°)
    const pct = ((diff / base) * 100).toFixed(1); // ë°±ë¶„ìœ¨
    
    let term = "";
    let cssClass = "";
    let sign = diff > 0 ? "+" : "";

    if (diff > 0) {
        cssClass = "diff-high";
        // ê°’ì´ í´ ê²½ìš° 'ì´ˆê³¼(Exceedance)', ì‘ì„ ê²½ìš° 'ìƒìŠ¹(Increase)' ë“±ì˜ ìš©ì–´ í˜¼ìš©
        term = `<span class="${cssClass}">í‰ë…„ í¸ì°¨ìœ¨ ${sign}${pct}% (ê°•ë„ ë¹„ ${ratio})</span>`;
    } else {
        cssClass = "diff-low";
        term = `<span class="${cssClass}">í‰ë…„ í¸ì°¨ìœ¨ ${pct}% (ê°•ë„ ë¹„ ${ratio})</span>`;
    }
    
    return `${term} <span style="font-size:12px; color:#888;">*í‰ê·  ${base}${unit} ê¸°ì¤€</span>`;
}

/* ==================== RENDERING HELPERS ==================== */

function generateVisualBar(level) {
    const safeLevel = level.replace("-", " "); 
    return `
    <div class="risk-bar-wrapper" data-level="${safeLevel}">
        <div class="risk-segment s1"></div>
        <div class="risk-segment s2"></div>
        <div class="risk-segment s3"></div>
        <div class="risk-segment s4"></div>
        <div class="risk-segment s5"></div>
    </div>`;
}

function getSummaryText(type, level) {
    const map = {
        "Wind": { "EXTREME":"êµ¬ì¡°ë¬¼ íŒŒì† ì„ê³„ì¹˜ ì´ˆê³¼", "HIGH":"ë‚´í’ ì•ˆì •ì„± ê²€í†  í•„ìš”", "MEDIUM":"ì¼ë°˜ í•˜ì¤‘ ì¡°ê±´", "LOW":"ì•ˆì „ ë²”ìœ„", "VERY LOW":"ì˜í–¥ ë¯¸ë¯¸" },
        "RainDaily": { "EXTREME":"ì‚¬ë©´ ìŠ¬ë¼ì´ë”© ìœ„í—˜", "HIGH":"ë°°ìˆ˜ ìš©ëŸ‰ ë¶€ì¡± ìš°ë ¤", "MEDIUM":"ì¼ë°˜ ê´€ë¦¬ ìˆ˜ì¤€", "LOW":"ì•ˆì „ ë²”ìœ„", "VERY LOW":"ì˜í–¥ ë¯¸ë¯¸" },
        "Rain1h": { "EXTREME":"ëŒë°œ í™ìˆ˜(Flash Flood)", "HIGH":"ì¹¨ìˆ˜ ê°€ëŠ¥ì„± ë†’ìŒ", "MEDIUM":"ì¼ë°˜ ê´€ë¦¬ ìˆ˜ì¤€", "LOW":"ì•ˆì „ ë²”ìœ„", "VERY LOW":"ì˜í–¥ ë¯¸ë¯¸" },
        "Snow": { "EXTREME":"êµ¬ì¡°ë¬¼ ë¶•ê´´ í•˜ì¤‘", "HIGH":"ì œì„¤ ëŒ€ì±… ìˆ˜ë¦½ í•„ìˆ˜", "MEDIUM":"ì¼ë°˜ ì ì„¤ í•˜ì¤‘", "LOW":"ì•ˆì „ ë²”ìœ„", "VERY LOW":"ìì—° ìœµì„¤ ê°€ëŠ¥" }
    };
    return map[type][level] || map[type]["VERY LOW"] || "í‰ê°€ ì¤‘";
}

/* ==================== ANALYTICS TEXT GENERATOR ==================== */

function generateDetailAnalysis(type, level, val, base, unit) {
    const diffHTML = getProfessionalDiffHTML(val, base, unit);
    const isHighRisk = (level === "HIGH" || level === "EXTREME");
    
    let title = "", content = "";
    
    if(type === "Wind") {
        title = "â–  í’í•˜ì¤‘ ë° ë‚´í’ ì„¤ê³„ ì ì •ì„± (Wind Load Analysis)";
        content = `ëŒ€ìƒ ë¶€ì§€ì˜ ì„¤ê³„ ê¸°ì¤€ í’ì†ì€ <b>${val}m/s</b>ë¡œ ì…ë ¥ë˜ì—ˆìœ¼ë©°, ì´ëŠ” ${diffHTML}ì— í•´ë‹¹í•©ë‹ˆë‹¤. <br><br>`;
        
        if(isHighRisk) {
            content += `í˜„ì¬ í’ì†ì€ êµ¬ì¡°ë¬¼ì˜ <span class="tech-term">í•œê³„ ìƒíƒœ(Limit State)</span>ë¥¼ ìœ„í˜‘í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤. ëª¨ë“ˆì˜ ì²´ê²°ë ¥(Clamping Force)ì´ ì„¤ê³„ í•˜ì¤‘ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , êµ¬ì¡°ë¬¼ ë‹¨ë¶€ ë° ëª¨ì„œë¦¬ ì˜ì—­(Edge/Corner Zone)ì— ëŒ€í•œ <span class="tech-term">ë³´ê°• ë¸Œë ˆì´ì‹±(Bracing)</span> ì„¤ì¹˜ë¥¼ ê°•ë ¥íˆ ì œì•ˆí•©ë‹ˆë‹¤.`;
        } else {
            content += `ì¼ë°˜ì ì¸ êµ¬ì¡° ì„¤ê³„ ê¸°ì¤€(KBC/KDS) ë²”ìœ„ ë‚´ì— ì¡´ì¬í•©ë‹ˆë‹¤. ë‹¨, êµ­ì§€ì  ëŒí’ ê³„ìˆ˜(Gust Factor)ë¥¼ ê³ ë ¤í•˜ì—¬ ì£¼ìš” ë³¼íŠ¸ ì²´ê²°ë¶€ì˜ í’€ë¦¼ ë°©ì§€ ë„ˆíŠ¸ ì ìš© ì—¬ë¶€ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì ê²€í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`;
        }
    } 
    else if(type === "RainDaily") {
        title = "â–  ìˆ˜ë¬¸í•™ì  ì•ˆì •ì„± ë° ë°°ìˆ˜ ê³„íš (Hydrological Stability)";
        content = `ì¼ì¼ ìµœëŒ€ ê°•ìš°ëŸ‰ <b>${val}mm</b>ëŠ” ${diffHTML} ìˆ˜ì¹˜ì…ë‹ˆë‹¤. ì´ëŠ” í† ì–‘ì˜ <span class="tech-term">í¬í™”ë„(Degree of Saturation)</span>ì™€ ì§ê²°ë©ë‹ˆë‹¤.<br><br>`;
        
        if(isHighRisk) {
            content += `ì§€ë°˜ì˜ ì „ë‹¨ ê°•ë„(Shear Strength) ì €í•˜ë¡œ ì¸í•œ <span class="tech-term">ì‚¬ë©´ í™œë™(Slope Failure)</span> ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì ˆí†  ë° ì„±í†  êµ¬ê°„ì˜ ë²•ë©´ ë³´í˜¸ê³µ(Seed Spray, Geogrid ë“±) ìƒíƒœë¥¼ ì¬í‰ê°€í•˜ê³ , ì‚°ë§ˆë£¨ ì¸¡êµ¬ì˜ í†µìˆ˜ ë‹¨ë©´ì ì„ ì„¤ê³„ ê¸°ì¤€ ëŒ€ë¹„ 1.2ë°° ì´ìƒ í™•ë³´í•  ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤.`;
        } else {
            content += `ê¸°ì¡´ ë°°ìˆ˜ ì‹œìŠ¤í…œìœ¼ë¡œ ê°ë‹¹ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ê°•ìš°ëŸ‰ì…ë‹ˆë‹¤. ë‹¤ë§Œ, ì¥ê¸°ì ì¸ ì¹¨ì‹ ë°©ì§€ë¥¼ ìœ„í•´ ìš°ê¸° ì „ ë°°ìˆ˜ë¡œ ë‚´ í‡´ì í†  ì¤€ì„¤ ë° ì¡ëª© ì œê±° ì‘ì—…ì„ í¬í•¨í•œ <span class="tech-term">ì˜ˆë°©ì  ìœ ì§€ê´€ë¦¬(Preventive Maintenance)</span> ê³„íšì„ ìˆ˜ë¦½í•˜ì‹­ì‹œì˜¤.`;
        }
    }
    else if(type === "Rain1h") {
        title = "â–  ëŒë°œ í™ìˆ˜ ë° ì¹¨ìˆ˜ ë¦¬ìŠ¤í¬ (Flash Flood Risk)";
        content = `ì‹œê°„ë‹¹ ì§‘ì¤‘ í˜¸ìš°ëŸ‰ <b>${val}mm</b>ëŠ” ${diffHTML} ìˆ˜ì¤€ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>`;
        
        if(isHighRisk) {
            content += `ë‹¨ì‹œê°„ ì§‘ì¤‘ í˜¸ìš°ë¡œ ì¸í•œ <span class="tech-term">í‘œë©´ ìœ ì¶œìˆ˜(Surface Runoff)</span>ê°€ ê¸‰ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶€ì§€ ë‚´ ì €ë¥˜ì¡°(Detention Pond)ì˜ ìš©ëŸ‰ ì ì •ì„±ì„ ì¬ê²€í† í•˜ê³ , ì£¼ìš” ì „ê¸° ì„¤ë¹„(ì¸ë²„í„°, ìˆ˜ë°°ì „ë°˜)ì˜ ê¸°ì´ˆ íŒ¨ë“œ ë†’ì´(Level)ë¥¼ ì§€ë©´(G.L.)ìœ¼ë¡œë¶€í„° ì¶©ë¶„íˆ ì´ê²©ì‹œì¼œ ì¹¨ìˆ˜ í”¼í•´ë¥¼ ì˜ˆë°©í•´ì•¼ í•©ë‹ˆë‹¤.`;
        } else {
            content += `ìˆœê°„ì ì¸ ë°°ìˆ˜ ë¶€í•˜ì—ëŠ” í° ë¬¸ì œê°€ ì—†ì„ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤. ë‹¤ë§Œ, ë¶€ì§€ ë‚´ ì €ì§€ëŒ€(Low-lying Area)ì˜ ìì—° ë°°ìˆ˜ íë¦„ì´ ì›í™œí•œì§€ í™•ì¸í•˜ê³  ìš°ìˆ˜ ê´€ë¡œì˜ ë§‰í˜ ì—¬ë¶€ë¥¼ ì ê²€í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.`;
        }
    }
    else if(type === "Snow") {
        title = "â–  ì ì„¤ í•˜ì¤‘ ë° êµ¬ì¡°ë¬¼ ë³€í˜• (Snow Load Impact)";
        content = `ìµœì‹¬ì‹ ì ì„¤ <b>${val}cm</b>ëŠ” ${diffHTML}ì— í•´ë‹¹í•˜ë©°, ì ì„¤ í•˜ì¤‘ ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br><br>`;
        
        if(isHighRisk) {
            content += `ìŠµì„¤(Wet Snow) ì¡°ê±´ì—ì„œëŠ” ë‹¨ìœ„ ì¤‘ëŸ‰ì´ ì¦ê°€í•˜ì—¬ êµ¬ì¡°ë¬¼ì— <span class="tech-term">ì˜êµ¬ ë³€í˜•(Permanent Deformation)</span>ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“ˆ ê²½ì‚¬ê°ì„ ì´ìš©í•œ ìì—° í™œì„¤(Sliding) ìœ ë„ ê°€ëŠ¥ì„±ì„ í™•ì¸í•˜ê³ , í­ì„¤ ì˜ˆë³´ ì‹œ í˜„ì¥ ì œì„¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¦‰ê° ê°€ë™í•  ìˆ˜ ìˆëŠ” ë¹„ìƒ ëŒ€ì‘ ì²´ê³„ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.`;
        } else {
            content += `êµ¬ì¡°ì  ì•ˆì „ìœ¨ ë‚´ì—ì„œ ì¶©ë¶„íˆ ì§€ì§€ ê°€ëŠ¥í•œ ì ì„¤ëŸ‰ì…ë‹ˆë‹¤. êµ¬ì¡°ë¬¼ ì•ˆì „ë³´ë‹¤ëŠ” ì ì„¤ë¡œ ì¸í•œ ìŒì˜(Shading) ë°œìƒ ë° ë°œì „ íš¨ìœ¨ ì €í•˜ ë°©ì§€ì— ì´ˆì ì„ ë§ì¶˜ ë™ì ˆê¸° ìš´ìš© ê³„íšì´ í•„ìš”í•©ë‹ˆë‹¤.`;
        }
    }

    return `<div class="analysis-box"><h3>${title}</h3><p>${content}</p></div>`;
}

function generateExecutiveSummary(levels) {
    const dangerCount = Object.values(levels).filter(l => l === "HIGH" || l === "EXTREME").length;
    let text = "";
    
    if(dangerCount >= 3) {
        text = `ğŸš¨ <b>[Critical] ë³µí•© ìì—°ì¬í•´ ì·¨ì•½ ì§€ì—­ (Multi-Hazard High Risk)</b><br>3ê°œ ì´ìƒì˜ í•­ëª©ì´ ì„ê³„ì¹˜ë¥¼ ì´ˆê³¼í•˜ì—¬ êµ¬ì¡°ì /ìˆ˜ë¦¬ì  ë¦¬ìŠ¤í¬ê°€ ì¤‘ì²©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¦‰ê°ì ì¸ ì •ë°€ ì•ˆì „ ì§„ë‹¨ ë° ë³´ê°• ëŒ€ì±…ì´ ìš”êµ¬ë©ë‹ˆë‹¤.`;
    } else if (dangerCount > 0) {
        const risks = Object.entries(levels).filter(([k,v]) => v==="HIGH"||v==="EXTREME").map(([k,v]) => k);
        text = `âš ï¸ <b>[Caution] íŠ¹ì • ì¬í•´ ìš”ì†Œ ì§‘ì¤‘ ê´€ë¦¬ í•„ìš”</b><br>íŠ¹íˆ <b>${risks.join(", ")}</b> í•­ëª©ì˜ ìœ„í—˜ë„ê°€ ë†’ê²Œ í‰ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ìš”ì†Œì— ëŒ€í•œ ì„ íƒì  ì§‘ì¤‘ ë³´ê°•(Targeted Retrofitting)ì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
    } else {
        text = `âœ… <b>[Stable] ìì—°ì¬í•´ ì•ˆì „ ì…ì§€ (Low Risk Area)</b><br>ë¶„ì„ëœ ëª¨ë“  ê¸°ìƒ ìš”ì†Œê°€ í‘œì¤€ ì„¤ê³„ í—ˆìš© ë²”ìœ„ ë‚´ì— ìˆìŠµë‹ˆë‹¤. í†µìƒì ì¸ O&M ì ˆì°¨ì— ë”°ë¥¸ ìš´ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
    }
    
    return `<h3>ğŸ“Š Executive Summary</h3><p style="margin:0;">${text}</p>`;
}

/* ==================== COMPREHENSIVE ENGINEERING OPINION (LOGIC UPDATED) ==================== */

function generateProfessionalOpinion(site, levels, vals) {
    // 1. ì „ì²´ì ì¸ ë¦¬ìŠ¤í¬ í”„ë¡œíŒŒì¼ë§
    const riskLevels = Object.values(levels);
    const maxRisk = riskLevels.includes("EXTREME") ? "EXTREME" : (riskLevels.includes("HIGH") ? "HIGH" : "NORMAL");
    
    let paragraph1 = "";
    let paragraph2 = "";
    let paragraph3 = "";

    // P1. ê°œìš” ë° ìƒíƒœ ì •ì˜
    if (maxRisk === "EXTREME") {
        paragraph1 = `ë³¸ í‰ê°€ëŠ” <b>${site}</b>ì˜ ê¸°ìƒ ìˆ˜ë¬¸í•™ì  ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆìœ¼ë©°, ë¶„ì„ ê²°ê³¼ ëŒ€ìƒ ë¶€ì§€ëŠ” <span class="tech-term" style="color:#c62828">ê·¹í•œ ê¸°í›„ ë…¸ì¶œ(Extreme Weather Exposure)</span> ìœ„í—˜ë„ê°€ ë§¤ìš° ë†’ì€ ê²ƒìœ¼ë¡œ ì‹ë³„ë˜ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì¼ë¶€ í•­ëª©ì€ ì„¤ê³„ ì¬í˜„ ì£¼ê¸°(Return Period) ë‚´ì˜ ìµœëŒ€ê°’ì„ ìƒíšŒí•  ê°€ëŠ¥ì„±ì´ ìˆì–´ êµ¬ì¡°ë¬¼ì˜ ì•ˆì „ìœ¨(Safety Factor) ì¬ì‚°ì •ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.`;
    } else if (maxRisk === "HIGH") {
        paragraph1 = `<b>${site}</b>ì— ëŒ€í•œ ìì—°ì¬í•´ ë¦¬ìŠ¤í¬ í‰ê°€ ê²°ê³¼, ì „ë°˜ì ì¸ ì…ì§€ ì—¬ê±´ì€ ì–‘í˜¸í•˜ë‚˜ íŠ¹ì • ê¸°ìƒ ìš”ì†Œì— ëŒ€í•´ <span class="tech-term" style="color:#ef6c00">ì£¼ì˜(Cautionary)</span> ë‹¨ê³„ì˜ ê´€ë¦¬ê°€ ìš”êµ¬ë©ë‹ˆë‹¤. ì´ëŠ” í‘œì¤€ ì„¤ê³„ ê¸°ì¤€ì„ ì¶©ì¡±í•˜ë”ë¼ë„ ê¸°í›„ ë³€í™”ë¡œ ì¸í•œ ë¶ˆí™•ì‹¤ì„±(Uncertainty)ì„ ê³ ë ¤í–ˆì„ ë•Œ ì ì¬ì  ë¦¬ìŠ¤í¬ê°€ ì¡´ì¬í•¨ì„ ì‹œì‚¬í•©ë‹ˆë‹¤.`;
    } else {
        paragraph1 = `<b>${site}</b>ì˜ ê¸°ìƒ ë°ì´í„°ëŠ” ëŒ€í•œë¯¼êµ­ ê¸°í›„ í‰ë…„ê°’ ë²”ìœ„ ë‚´ì—ì„œ ì•ˆì •ì ì¸ ë¶„í¬ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ê³µí•™ì  ê´€ì ì—ì„œ ë³¼ ë•Œ, í˜„ì¬ì˜ ì„¤ê³„ ë° ì‹œê³µ ê¸°ì¤€ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•œ <span class="tech-term" style="color:#2e7d32">êµ¬ì¡°ì  ê±´ì „ì„±(Structural Integrity)</span> í™•ë³´ê°€ ê°€ëŠ¥í•œ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.`;
    }

    // P2. ê¸°ìˆ ì  ì œì•ˆ (Technical Recommendation)
    if (maxRisk === "EXTREME" || maxRisk === "HIGH") {
        paragraph2 = `ì—”ì§€ë‹ˆì–´ë§ ì¸¡ë©´ì—ì„œ ê°€ì¥ ìš°ì„ ìˆœìœ„ë¥¼ ë‘ì–´ì•¼ í•  ì‚¬í•­ì€ <b>ì·¨ì•½ êµ¬ê°„ì˜ êµ¬ì¡° ë³´ê°•</b> ë° <b>ë°°ìˆ˜ ì²´ê³„ì˜ ê³ ë„í™”</b>ì…ë‹ˆë‹¤. ë‹¨ìˆœí•œ ì‚¬í›„ ìœ ì§€ë³´ìˆ˜(Corrective Maintenance) ì „ëµìœ¼ë¡œëŠ” ìì‚° ê°€ì¹˜ë¥¼ ë³´ì¡´í•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ, ë¦¬ìŠ¤í¬ê°€ ì‹ë³„ëœ í•­ëª©(ìƒê¸° High/Extreme ë“±ê¸‰)ì— ëŒ€í•´ì„œëŠ” ì „ë¬¸ êµ¬ì¡° ê¸°ìˆ ì‚¬ì˜ ê²€í† ë¥¼ í†µí•´ <span class="tech-term">ë³´ê°• ì„¤ê³„ë¥¼ ì ìš©(Retrofitting Design)</span>í•˜ê±°ë‚˜, ì¬í•´ ë°©ì§€ ì‹œì„¤ì˜ ìš©ëŸ‰ì„ ì„¤ê³„ ê¸°ì¤€ ëŒ€ë¹„ 120% ì´ìƒìœ¼ë¡œ ìƒí–¥ ì¡°ì •í•  ê²ƒì„ ê°•ë ¥íˆ ê¶Œê³ í•©ë‹ˆë‹¤.`;
    } else {
        paragraph2 = `í˜„ì¬ ìˆ˜ì¤€ì—ì„œëŠ” ê³¼ë„í•œ ì„¤ë¹„ íˆ¬ìë³´ë‹¤ëŠ” <span class="tech-term">ì˜ˆë°©ì  ì ê²€ ì²´ê³„(Preventive Inspection System)</span> í™•ë¦½ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ê²½ì œì ì…ë‹ˆë‹¤. ë¶„ê¸°ë³„ ì •ê¸° ì ê²€ ì‹œ ë³¼íŠ¸ ì²´ê²° í† í¬ ê°’ í™•ì¸, ë°°ìˆ˜ë¡œ í†µìˆ˜ ëŠ¥ë ¥ ì ê²€, ì‚¬ë©´ ì¸ì¥ ê· ì—´ ì—¬ë¶€ í™•ì¸ ë“±ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸í™”í•˜ì—¬ ê´€ë¦¬í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`;
    }

    // P3. ê²°ë¡ 
    paragraph3 = `ê²°ë¡ ì ìœ¼ë¡œ, ë³¸ ë¶€ì§€ëŠ” ${maxRisk === "EXTREME" ? "íŠ¹ë‹¨ì˜ ë°©ì¬ ëŒ€ì±… ìˆ˜ë¦½ì´ ì„ í–‰ë˜ì–´ì•¼ ì‚¬ì—…ì˜ ì§€ì† ê°€ëŠ¥ì„±ì„ ë‹´ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." : (maxRisk === "HIGH" ? "ì‹ë³„ëœ ë¦¬ìŠ¤í¬ ìš”ì¸ì— ëŒ€í•œ ì„ ì œì  ëŒ€ì‘ì±… ë§ˆë ¨ ì‹œ ì•ˆì •ì ì¸ ë°œì „ì†Œ ìš´ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤." : "ìì—°ì¬í•´ë¡œ ì¸í•œ ì¤‘ëŒ€ ì‚¬ê³  ë°œìƒ ê°€ëŠ¥ì„±ì€ ë‚®ìœ¼ë‚˜, ê¸°ë³¸ì ì¸ ì‹œì„¤ë¬¼ ì•ˆì „ ê´€ë¦¬ ê·œì •ì„ ì¤€ìˆ˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.")}`;

    return `${paragraph1}<br><br>${paragraph2}<br><br>${paragraph3}`;
}


/* ==================== MAIN ACTION ==================== */

// ìˆ˜ì •ëœ ëœë¤ ìƒ˜í”Œ ë°ì´í„° ìƒì„± í•¨ìˆ˜
function fillExampleData() {
    // 1. ëœë¤ ìˆ«ì ìƒì„± í—¬í¼ (ë²”ìœ„: 0 ~ Baseê°’ * 2.5)
    // Base * 2.5ë¥¼ í•˜ë©´ +150%ê¹Œì§€ ì»¤ë²„ë¨ (100% + 150% = 250% = 2.5ë°°)
    function getRandomVal(base) {
        const max = base * 2.5; 
        const random = Math.random() * max;
        return random.toFixed(1);
    }

    // 2. ê°’ ì£¼ì…
    const randomId = Math.floor(Math.random() * 99) + 1;
    document.getElementById("site_name").value = `ëœë¤ ì‹œë®¬ë ˆì´ì…˜ ë°œì „ì†Œ ${randomId}í˜¸`;
    document.getElementById("wind_value").value = getRandomVal(KMA_BASE.WIND);
    document.getElementById("rainD_value").value = getRandomVal(KMA_BASE.RAIN_DAILY);
    document.getElementById("rain1_value").value = getRandomVal(KMA_BASE.RAIN_1H);
    document.getElementById("snow_value").value = getRandomVal(KMA_BASE.SNOW);
}

function renderReport(){
    // 1. Get Values
    const site = document.getElementById("site_name").value || "ë¯¸ì§€ì • ë°œì „ì†Œ";
    const vWind = document.getElementById("wind_value").value;
    const vRainD = document.getElementById("rainD_value").value;
    const vRain1 = document.getElementById("rain1_value").value;
    const vSnow = document.getElementById("snow_value").value;

    // 2. Validation
    if(!vWind || !vRainD || !vRain1 || !vSnow) {
        alert("ëª¨ë“  ê¸°ìƒ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    const val = {
        Wind: parseFloat(vWind),
        RainDaily: parseFloat(vRainD),
        Rain1h: parseFloat(vRain1),
        Snow: parseFloat(vSnow)
    };

    // 3. Calc Levels
    const levels = {
        Wind: determineLevel("Wind", val.Wind),
        RainDaily: determineLevel("RainDaily", val.RainDaily),
        Rain1h: determineLevel("Rain1h", val.Rain1h),
        Snow: determineLevel("Snow", val.Snow)
    };

    // 4. Render Table
    const tbody = document.getElementById("risk-table-body");
    let trs = "";
    const items = [
        { key: "Wind", label: "Wind (í’ì†)", unit: "m/s" },
        { key: "RainDaily", label: "Daily Rain (ì¼ ê°•ìš°)", unit: "mm" },
        { key: "Rain1h", label: "1h Rain (ì‹œ ê°•ìš°)", unit: "mm" },
        { key: "Snow", label: "Snow (ì ì„¤)", unit: "cm" }
    ];

    items.forEach(item => {
        const lvl = levels[item.key];
        const v = val[item.key];
        const safeLvlClass = lvl.replace(" ", "-"); 
        
        trs += `<tr>
            <td><b>${item.label}</b></td>
            <td>${v} ${item.unit}</td>
            <td><span class="badge ${safeLvlClass}">${lvl}</span></td>
            <td>${generateVisualBar(lvl)}</td>
            <td>${getSummaryText(item.key, lvl)}</td>
        </tr>`;
    });
    tbody.innerHTML = trs;

    // 5. Render Executive Summary
    document.getElementById("executive_summary").innerHTML = generateExecutiveSummary(levels);

    // 6. Render Detail Analysis
    let details = "";
    details += generateDetailAnalysis("Wind", levels.Wind, val.Wind, KMA_BASE.WIND, "m/s");
    details += generateDetailAnalysis("RainDaily", levels.RainDaily, val.RainDaily, KMA_BASE.RAIN_DAILY, "mm");
    details += generateDetailAnalysis("Rain1h", levels.Rain1h, val.Rain1h, KMA_BASE.RAIN_1H, "mm");
    details += generateDetailAnalysis("Snow", levels.Snow, val.Snow, KMA_BASE.SNOW, "cm");
    document.getElementById("detail-analysis").innerHTML = details;

    // 7. Render Extended Opinion (ì „ë¬¸ì ì¸ ì†Œê²¬ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ)
    document.getElementById("extended-analysis").innerHTML = generateProfessionalOpinion(site, levels, val);

    // 8. Show Report
    document.getElementById("generated_report").style.display = "block";
    
    // Scroll to report
    setTimeout(() => {
        document.getElementById("generated_report").scrollIntoView({ behavior: 'smooth' });
    }, 100);
}
</script>
</body>
</html>
